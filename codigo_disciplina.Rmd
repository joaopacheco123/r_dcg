---
title: "Análise de dados em saúde mental"
author: "Maurício Hoffmann, João Pacheco & João Amaral"
date: "03/06/2021"
output:
  html_document:
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scrool: yes
editor_options:
  chunk_output_type: console
  markdown: 
    wrap: 72
---

Cronograma

11/08/2023
Aula 1 (João Amaral)
- Cronograma da primeira parte

Introdução à Linguagem R:
	- Instalação 
	- Ambiente do RStudio
	- Script com comandos
	- Operações matemáticas
	- Objetos, funções, operadores
	- Números, vetores, tabelas de dados e matrizes
	- Instalando e carregando pacotes.

	- Apresentar os livros principais - Utiliznaod a linguagem R
					  - Discovering statistics using R (Andy Field)
					  - R in Action
					  - R Cookbook
- Lista de exercícios

(propor coleta de dados:
	- idade
	- altura
	- filmes favoritos (ação, drama, aventura, ficção científica, suspense/terror)
	- gênero musical favorito (pop, rock, clássico, sertanejo)
	- atividade física (quantos dias em média por semana, você pratica atividade física)
	- níveis de estresse 
	- bem-estar
	- personalidade (neuroticismo e extroversão)) - escore fatorial


Prova: 
Gerar um arquivo markdown respondendo perguntas específicas conforme cada aula no banco de dados gerado. 
O código deve rodar e gerar resultados corretos conforme o gabarito. 


18/08/2023
Aula 2 (João Pacheco)
RMarkdown
	- Documento de saída
	- Títulos e subtítulos
	- Chunks
	- Tabelas
- Lista de exercícios


25/08/2023
Aula 3 - Importando dados e usando funções importantes "Base R" (João Amaral)

	- Importando dados.
	- Funções importantes:
		- Comentário, 
		- Atribuir, 
		- Concatenar,  
		- str(D)
		- head(D)
		- round(x, k)
		- sum(x)
		- cbind e rbind
		- Ajuda
	- Pedindo ajuda para o chatgpt!
- Lista de exercícios

01/09/2023
Aula 4 - Estrutura de dados (João Pacheco)
	- Níveis de medida, tipos de variáveis (usar aula do maurício ou do mestrado)
	- Tipos de dados: vetores, matrizes, arrays, dados etc (R in Action)
	- Fatores (R in action)
	- Listas 
	- Dados organizados (tidy data) (R For data Science)
- Lista de exercícios

15/09/2023
Aula 5 - Manipulando dados com dplyr (João Amaral)
	- Tibble
	- Identificando e modificando o tipo da variável
	- Operador pipe
	- Funções mais complexas: select(), pull(), filter(), distinct(), arrange(), mutate(), transmute(), summarise(), group_by(), add_column(), add_row(), rename()
	- pivot_longer() e pivot_wider()
	- separate() e unite()
	- complete(), drop_na(), replace_na()
	- if_else() e case_when()
- Lista de exercícios

22/09/2023
Aula 6 - Estatística descritiva e tabelas (João Amaral)
	- frequências
	- mean(x), median(x), min(x), max(x)
	- Pacote DescTools
- Lista de exercícios

29/09/2023
Aula 7 - Visualizando dados e modelando (João Pacheco)
	- Visualizando dados (R base) - plot - dar vários exemplos de plots
	- E estatística inferencial básica (modelando a relação entre duas variáveis)
- Lista de exercícios

06/10/2023
Aula 8 - Gráficos avançados usando ggplot2 (João Pacheco) (???)
	- Linguagem gráfica ggplot2
	- Gráficos avançados usando ggplot2
- Lista de exercícios


## Introdução

R e R studio são softwares gratuitos.

R é baseado em sintaxe (linguagem), não em point-and-click.

-   Mais flexibilidade

-   Facilita gravar todas as transformações nos dados e análises

### **Objetos**

R grava seus dados em 'objetos' - aba 'environment'

### **Funções**

São tipos especiais de objetos que realizam ações sobre outros objetos.

Muito da funcionalidade do R se dá através da aplicação de funções aos
dados.

Exemplo: isTRUE(x) - teste de se 'x' é verdade
Exemplo: isTRUE(x) - teste de se 'x' é verdade 

### **Operadores**

São sinais que também realizam ações sobre objetos.

#### **Aritméticos**

| Operador   | Descrição                   |
|------------|-----------------------------|
| \+         | adição                      |
| \-         | subtração                   |
| \*         | multiplicação               |
| /          | divisão                     |
| \^ ou \*\* | exponenciação / potenciação |

#### **Lógicos e de comparação**

| Operador | Descrição          |
|----------|--------------------|
| \<       | menor que          |
| \<=      | menor ou igual     |
| \>       | maior que          |
| \>=      | maior ou igual     |
| ==       | exatamente igual a |
| !=       | diferente de       |
| !x       | não 'x'            |
| x \| y   | 'x' ou 'y'         |
| x & y    | 'x' e 'y'          |

### **Pacotes**

O software básico do R já vem com várias funções pré-instaladas.

Para adicionar funções, é necessário a instalação de pacotes (próximo
tópico).

## Instalação

### Instalando R e RStudio

1)  R: <http://www.r-project.org>
2)  RStudio: <https://www.rstudio.com/>

### Instalando pacotes

```{r eval=FALSE, include=FALSE}
install.packages("psych")

# Para instalar com as dependências:
install.packages("psych", dependencies = TRUE)
```

Depois, é importante carregar o pacote para utilizá-lo:

```{r}
library(psych)
```

### Explorando pacotes

Esta página permite explorar os pacotes, por tópicos:
<https://cran.r-project.org/web/views/>

![](Capturar1.PNG)

## Algumas funções importantes

### Comentário

O símbolo \# é utilizado para fazer comentários no seu código.

```{r}
# Isto é um comentário.
```

### Atribuir

O símbolo \<- é utilizado para atribuir o que quer que esteja na direita
ao objeto à esquerda.

```{r}
# Atribuindo valor '1' a x
x <- 1

# Visualizando
x

# Atribuindo valor "1+2"
x <- 1+2
x

# Verificando se x é menor que 2
isTRUE(x<2)
```

Repare que para verificar o resultado, basta escrever 'x', e o programa
devolve que x é 1.

### Concatenar

A função "c()" irá concatenar valores/argumentos incluídos na função.

```{r}
# Concatenando valores no objeto 'meus.dados'
meus.dados <- c(1, 2, 3)

# Visualizando
meus.dados
```

Existem duas variações dessa função: cbind() e rbind(). A primeira
combina objetos como colunas, a segunda como linhas. Exemplo:

```{r}
# Criando vetores
sexo <- c("mas", "fem", "mas", "fem", "mas")
idade <- c(12, 21, 33, 25, 36)
status_estudante <- c(TRUE, FALSE, TRUE, FALSE, TRUE)

# Concatenando como colunas diferentes
meus.dados <- cbind(sexo, idade, status_estudante)

# Verificando a estrutura
str(meus.dados) 

# A estrutura não parece correta... melhor salvar como data.frame
meus.dados <- data.frame(sexo, idade, status_estudante)
str(meus.dados)
```

Vimos que a função data.frame também é importante, por isso vamos
explorá-la mais adiante.

### Ajuda

A função "help()" traz uma página que descreve a função, seus argumentos
e dá alguns exemplos.

```{r eval=FALSE, include=FALSE}
# Pedindo ajuda com uma função
help(mean)

# Escrever "?" também funciona como help()
?mean

# Pedindo ajuda com um pacote
help(psych)
?psych
```

### Exemplos

A função "example()"

```{r}
# Solicitando exemplo da funcão "mean"
example("mean")
```

## Importanto dados

### Dados incluídos nos pacotes

Através do exemplo acima, vimos um exemplo de dados que já vieram com um
pacote. O conjunto de dados "HolzingerSwineford1939".

```{r}
help("mtcars")
```

"*The data was extracted from the 1974 Motor Trend US magazine, and
comprises fuel consumption and 10 aspects of automobile design and
performance for 32 automobiles (1973--74 models).*"

Para carregar os dados, digite data()

```{r}
data(mtcars)
```

Se quiser ter uma ideia de todos os bancos de dados disponíveis nos
pacotes que já estão carregados, digite data()

```{r}
data()
```

### Dados de uma fonte .csv ou .txt

Geralmente, os dados são armazenados em arquivos externos. A melhor
maneira é utilizando o formato .csv. Para isso, é necessário se lembrar
de algumas sugestões:

-   Codifique todos os "missing" como NA

-   Certifique-se de que nenhuma variável possui espaços. Utilize ponto
    ou *underline*. Exemplo: faixa.etaria ou faixa_etaria

-   É interessante não colocar acentos, no caso da língua portuguesa

-   Lembre-se de registrar decimais com ponto, e não com vírgula.

Depois que os dados estiverem salvos no computador, digite:

```{r eval=FALSE, include=FALSE}
meus.dados <- read.table(file.choose(), header = TRUE, sep = ",")
```

A função acima carrega o arquivo através de uma caixa de diálogo, mas
você pode digitar a localização, entre aspas, no lugar de
"file.choose()".

O argumento "header = TRUE" indica que a primeira linha é o nome da
variável.

O argumento "sep = ",""" indica que as colunas estão separadas por
vírgula. Se necessário, coloque "sep = ";"" quando as colunas forem
separadas por ponto e vírgula.

Ou, você pode selecionar diretamente o arquivo na aba "files".

### Dados de outros programas (SAS, SPSS, Stata, etc.)

Para carregar dados provenientes de outros programas, é mais fácil
procurar pelo arquivo na aba "files".

## Estruturas de dados

Quando você carrega um conjunto de dados através da função read.table,
eles ficam gravados como um objeto data.frame.

No R, existem 5 tipos diferentes de estruturas para os dados:

1.  Vector (vetor): são arranjos uni-dimensionais que podem conter dados
    numéricos, caracteres ou lógicos. São chamados também de vetor
    atômico (*atomic vectors*).

2.  Matrix (matriz): possui duas dimensões de dados (numéricos,
    caracteres ou lógicos).

3.  Array (arranjo): são como matrizes, porém podem ter mais de duas
    dimensões.

4.  Data frame (conjunto de dados): é a típica tabela que você encontra
    em outros programas. Podem conter diferentes tipos de dados.

5.  List (lista): coleção ordenada de objetos de diversos tipos,
    possivelmente não relacionados.

A figura 2.2 do livro "R in Action" mostra a diferença entre essas
estruturas:

![](Capturar2.PNG)

Como o data frame é o tipo mais comum de organização dos dados, vamos
criar um:

```{r}
# Exemplo adaptado do livro "R in Action"
patientID <- c(1, 1, 2, 3, 4, 5, 6)
idade <- c(25, 25, 34, 28, 52, 44, 36)
diabetes <- c("Tipo1", "Tipo1", "Tipo2", "Tipo1", "Tipo1", "Tipo2", "Tipo2")
status <- c("Bom", "Bom", "Bom", "Ruim", "Bom", "Ruim", "Ruim")
glicemia <- c(105, 105, 112, 240, 121, 330, 450)
dados.pacientes <- data.frame(patientID, idade, diabetes, status, glicemia)
dados.pacientes # Vemos que a primeira observação está repetida. Vamos ver depois como deletar essa observação.
```

É útil também utilizar a função str() para verificar a estrutura dos
dados:

```{r}
str(dados.pacientes)
```

No exemplo acima, podemos ver dois tipos de variável: chr (character) e
num (numeric).

### Tipos de dados

O R comporta 6 tipos básicos de dados:

-   Caractere (character). Ex. "fem", "f", "mas", "m"

-   Numérico (numeric): Ex. 2, 3.5, 734

-   Número inteiro (integer): Ex. 1L, 2L, 3L (a letra L mostra do R para
    salvar como inteiro)

-   Lógico (logical): TRUE, FALSE

-   Número complexo (complex): Ex. 1+4i

### Fatores (*factors*)

R in action

Dados categóricos podem ser codificados categoricamente (ex.
"Masculino", "Feminino"), ou através de números (ex. Masculino=0,
Feminino=1). O R classifica esses dados como níveis (*levels*) de um
fator (*factor*).

```{r}
# Verificando os níveis da variável diabetes, que é um fator:
factor(diabetes)

# Vamos codificar uma nova variável, em que Masculino=0, Feminino=1:
sexo <- c(0, 0, 1, 1, 1, 0, 0)

# O R compreende que essa variável é contínua. Para atribuir a codificação, utilize o código:
sexo <- factor(x = sexo, levels =0:1, labels = c("Mas", "Fem"))

sexo # Verificando

# Salvando no meu banco de dados, usando a função cbind()
dados.pacientes <- cbind(dados.pacientes, sexo)

# Visualizando
dados.pacientes
```

### Dados organizados (*tidy data*)

> Happy families are all alike; every unhappy family is unhappy in its
> own way --- Leo Tolstoy

Conjuntos de dados organizados são uma maneira padronizada de vincular a
estrutura (o layout físico) com a sua semântica (significado).

A estrutura de dados organizados é sempre a mesma:

1.  Cada coluna é uma variável.

2.  Cada linha é uma observação (exceto a primeira)

3.  Cada célula é um único valor

## Simulando dados

O R também possui algumas funções para simular dados. Por exemplo:

```{r}
# Criando uma simulação de 500 obs. de uma distribuição normal com média zero e desvio padrão de 1.
x <- rnorm(500, m=0, sd=1)

# Criando um histograma de x
hist(x)
```

## Manipulando dados

### Acessando variáveis

Vamos utilizar aqui o banco criado acima, "dados.pacientes".

Para acessar colunas específicas, utilizar o cifrão (\$). Podemos também
utilizar a função "anexar", attach(), que faz com que as variáveis
fiquem disponíveis diretamente. Por exemplo:

```{r}
# Antes de começar, vamos remover as variáveis do ambiente de trabalho.
rm(patientID, idade, diabetes, status, glicemia, sexo)

# Visualizando
dados.pacientes$idade

# Solicitando a média e desvio padrão
mean(dados.pacientes$idade)
sd(dados.pacientes$idade)

# Com a função attach
attach(dados.pacientes)
idade
status
mean(idade)

# Para 'desanexar' as variáveis. Lembrar de colocar entre aspas.
detach("dados.pacientes")
```

Para acessar elementos (observações) específicos, utilizar [ ]:

```{r}
# Visualizando a primeira observação da variável idade
dados.pacientes$idade[1]

# Visualizando a segunda observação da variável diabetes
dados.pacientes$diabetes[2]
```

Alterando e removendo valores:

```{r}
# Alterando a segunda observação da variável diabetes
dados.pacientes$diabetes[2] <- "Tipo1"

# Para remover valores, defina como NA:
dados.pacientes$idade[1] <- NA

# Visualizando
dados.pacientes

# Para deletar todos os casos com NA, utilize a função na.omit()
dados.pacientes <- na.omit(dados.pacientes)
dados.pacientes # Agora o primeiro paciente foi excluído do banco de dados.
```

## Estatística descritiva

Aqui verificamos algumas funções para estatística descritiva de dados
numéricos:

-   Média: mean()

-   Soma: sum()

-   Variância: var()

-   Desvio padrão: sd()

Entretanto, a melhor função é describe() do pacote psych. Podemos nos
referir à função como describe::psych. Ou seja, utilizando "::" estamos
dizendo que queremos utilizar a função describe do pacote psych (e não
de outros pacotes, caso exista).

```{r}
# Média
mean(dados.pacientes$idade)

# Soma
sum(dados.pacientes$idade)

# Variância
var(dados.pacientes$idade)

# Desvio padrão
sd(dados.pacientes$idade)

# Estatística descritiva das variáveis quantitativas, usando a função "describe":
psych::describe(dados.pacientes$idade)
psych::describe(dados.pacientes$glicemia)
```

Para dados categóricos, devemos fazer uma tabela de frequência,
utilizando a função table().

```{r}
table(dados.pacientes$sexo)
```

## Estatística inferencial

Vamos fazer agora algumas estatísticas inferenciais básicas.

```{r}
# Anexando as variáveis no ambiente de trabalho
attach(dados.pacientes)

# Correlação de Pearson entre duas variáveis
cor(idade, glicemia)

# Criando scores z
dados.pacientes$glicemia.z <- scale(glicemia)

# Verificando
dados.pacientes

# Fazendo um teste-t para comparar médias de duas amostras
t.test(glicemia ~ sexo) # Não significativo
t.test(glicemia ~ status) # Significativo

# Para médias da mesma amostra (pareadas), o código seria:
# t.test(glicemia ~ status, paired = TRUE)
# Não vamos calcular, já que não se aplica.

# Testando variância entre grupos
bartlett.test(glicemia, status) # Não significativo, ou seja, as variâncias não são homogêneas.

# Fazendo uma regressão
lm.glicemia.idade <- lm(glicemia ~ idade)
summary(lm.glicemia.idade)

detach("dados.pacientes")
```

## Gráficos

```{r}
# boxplot(glicemia ~ status)

# plot(glicemia ~ idade)
```
